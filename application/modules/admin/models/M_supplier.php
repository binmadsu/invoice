<?php class m_supplier extends CI_Model{	private $tbl_name = 'tbl_supplier';	function addpage()	{		$priority = $this->get_length();		$slug = url_title($this->input->post('supplier_name'), 'dash', true);		$serviceslug = $this->checkSlugExists($slug);		$uid = getCurUserID();        $uDetails = getAdminUserDetailsById($uid);        $usernameAdmin = isset($uDetails['full_name'])?$uDetails['full_name']:$uDetails['username'];		$data = array(			'slug' => $serviceslug,			'supplier_name' => $this->input->post('supplier_name'),			'supplier_code' => $this->input->post('supplier_code'),			'address1' => $this->input->post('address1'),			'address2' => $this->input->post('address2'),			'email_id' => $this->input->post('email_id'),			'phone' => $this->input->post('phone'),			'landline' => $this->input->post('landline'),			'city' => $this->input->post('city'),			'state' => $this->input->post('state'),			'country' => $this->input->post('country'),			'note' => $this->input->post('note'),			'is_active' => 1,			'delete_status' => 1,			'priority' => $priority,		);		//echo'<pre>';print_r($data);echo'</pre>';die;		$msg = 0;		$this->db->insert($this->tbl_name, $data);		$supplierid = $this->db->insert_id();		//echo $this->db->last_query();die;		$strtagItems = $this->input->post('tagItems');		$randomtagItems = explode(',', $strtagItems);		$intItemIds = array();		foreach ($randomtagItems as $k=>$value) {			if(is_numeric($value)){				$intItemIds[] = $value;			}		}		//echo ' ==1 = ';pr($intItemIds);		$tagItems = array_unique($intItemIds, SORT_NUMERIC);		//pr($tagItems);die;		foreach ($tagItems as $value) {			if(is_numeric($value) && $value && $supplierid){				$dataitems = array(					'supplierid' => $supplierid,					'itemid' => $value,				);				$this->db->insert('tbl_supplier_items', $dataitems);			}		}		$lastId = $this->db->insert_id();		//echo $this->db->last_query();die;		SaveAuditLog('New Supplier create', 'tbl_supplier', $lastId , $usernameAdmin );		$msg = ($this->db->affected_rows() > 0) ? $lastId : 0; //for insert //for insert		return $msg;	}	function checkSlugExists($slug){		$serviceslug = '';		$query = $this->db->query("select * from ".$this->tbl_name." where slug='".$slug."'");		$count = $query->num_rows();		// if slug pre exists		if ($count > 0) {			$id=rand(10000,99999);  			$shorturl=base_convert($id,20,36);			$serviceslug = $slug.$shorturl;			return $serviceslug;		}else		return $slug;	}		function listing($limit,$start)	{		$this->db->select('*');		$this->db->from($this->tbl_name);		$this->db->where('delete_status', 1);		$this->db->limit($limit, $start);		$this->db->order_by('priority','asc');		$query = $this->db->get();		//echo $this->db->last_query();die;		return $query->result_array();	}	function index($id){		$uid = getCurUserID();        $uDetails = getAdminUserDetailsById($uid);        $usernameAdmin = isset($uDetails['full_name'])?$uDetails['full_name']:$uDetails['username'];		$data = array(			'supplier_name' => $this->input->post('supplier_name'),			'supplier_code' => $this->input->post('supplier_code'),			'address1' => $this->input->post('address1'),			'address2' => $this->input->post('address2'),			'email_id' => $this->input->post('email_id'),			'phone' => $this->input->post('phone'),			'landline' => $this->input->post('landline'),			'city' => $this->input->post('city'),			'state' => $this->input->post('state'),			'country' => $this->input->post('country'),			'note' => $this->input->post('note'),		);		// echo'<pre>';print_r($data);echo'</pre>';die;		$msg = 0;		if( $id == 0 ){			$this->db->insert($this->tbl_name, $data);			$msg = ($this->db->affected_rows() > 0) ? 1 : 0;//for insert		}else{			$this->db->where('id',$id );		    $this->db->update($this->tbl_name, $data);			//echo $this->db->last_query();die;			$strtagItems = $this->input->post('tagItems');			$randomtagItems = explode(',', $strtagItems);			$intItemIds = array();			foreach ($randomtagItems as $k=>$value) {				if(is_numeric($value)){					$intItemIds[] = $value;				}			}			//echo ' == supplier : $id == ';pr($intItemIds);die;			$tagItems = array_unique($intItemIds, SORT_NUMERIC);			//pr($tagItems);die;			$this->db->delete('tbl_supplier_items', array('supplierid' => $id));			foreach ($tagItems as $value) {				if(is_numeric($value) && $value && $id){					$dataitems = array(						'supplierid' => $id,						'itemid' => $value,					);					$this->db->insert('tbl_supplier_items', $dataitems);				}			}            SaveAuditLog('Supplier Update', 'tbl_supplier', $id , $usernameAdmin );			$msg = ($this->db->affected_rows() > 0) ? 2 : 3;//for update : for nothing happened		}		return $msg;	}	function delete($pageid){		$this->db->delete($this->tbl_name, array('id' => $pageid));		return ($this->db->affected_rows() != 1) ? false : true;  	}	function DeleteStatus($id,$DeleteStatus){		$uid = getCurUserID();        $uDetails = getAdminUserDetailsById($uid);        $usernameAdmin = isset($uDetails['full_name'])?$uDetails['full_name']:$uDetails['username'];		$this->db->where('id',$id );        $this->db->set("delete_status", $DeleteStatus);        $this->db->update($this->tbl_name);		//echo $this->db->last_query();die;		SaveAuditLog('Delete Supplier', 'tbl_supplier', $id , $usernameAdmin );		return ($this->db->affected_rows() > 0) ? 2 : 0;//for insert // for update  	}			function status($id,$status){		$this->db->where('id',$id );        $this->db->set("is_active", $status);        $this->db->update($this->tbl_name);		//$this->output->enable_profiler(TRUE);		return ($this->db->affected_rows() > 0) ? 2 : 0;//for insert // for update  	}	  	function count_all(){		$this->db->select('*');		$query = $this->db->get($this->tbl_name);		return ($query->num_rows());	}	function page_info($id=0){		$arrData = array();$items = array();		$this->db->select('*');		$this->db->from($this->tbl_name);		if(!empty($id)){			$this->db->where('id',$id);		}		$query = $this->db->get();		foreach($query->result_array() as $colid => $data){			$arrData[$colid] = $data;		}		if($id){			$this->db->select('*');			$this->db->from('tbl_supplier_items');			$this->db->where('supplierid',$id);			$query2 = $this->db->get();			foreach($query2->result_array() as $row){				$itemname = getFieldByName(@$row['itemid'], 'item_name', 'tbl_item', 'item_name');				if($itemname)					$items[$row['itemid']] = $itemname;			}		}		$arrData['items'] = $items;		//return $query->result_array();		return $arrData;	}	function Updatepriority($id,$priority)	{		$this->db->where('id',$id );        $this->db->set("priority", $priority);        $this->db->update($this->tbl_name);		//$this->output->enable_profiler(TRUE);		//return ($this->db->affected_rows() > 0) ? 2 : 0;//for insert // for update	}	function get_length(){		$this->db->select('*');		$this->db->from($this->tbl_name);		$query = $this->db->get();		return count($query->result_array())+1;	}}?>