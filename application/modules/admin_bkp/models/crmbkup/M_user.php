<?php class m_user extends CI_Model{	private $tbl_name = 'userinfo';			function addpage()	{		//pr($_POST);die;		$info_btn = $this->input->post('user[info-btn]');		$userinfo_btn = $this->input->post('userinfo[userinfo-btn]');		$billing_btn = $this->input->post('billing[billing-btn]');		$payment_btn = $this->input->post('payment[payment-btn]');		$network_btn = $this->input->post('network[network-btn]');		$docoment_btn = $this->input->post('docoment[docoment-btn]');		//$billing_btn = $this->input->post('billing-btn');								if($info_btn == 'Next'){				$priority = $this->get_length('userinfo');				$slug = url_title($this->input->post('user[username]'), 'dash', true);				$serviceslug = $this->checkSlugExists($slug, 'userinfo');								$data = array(				'slug' => $serviceslug,				'username' => $this->input->post('user[username]'),				'portalloginpassword' => $this->input->post('user[portalloginpassword]'),				'zone' => $this->input->post('user[zone]'),				'plan_id' => $this->input->post('planname'),				'lco' => $this->input->post('user[lco]'),				'distributer' => $this->input->post('user[distributer]'),				'bussiness_Partner' => $this->input->post('user[bussiness_Partner]'),				'leadsource' => $this->input->post('user[leadsource]'),				'connection_type' => $this->input->post('user[connection_type]'),				'servicetype' => $this->input->post('user[servicetype]'),				'is_active' => 1,				'priority' => $priority,			);			//echo'<pre>';print_r($data);echo'</pre>';die;			$msg = 0;			$this->db->insert('userinfo', $data);			$lastId = $this->db->insert_id();			//echo $this->db->last_query();die;			$msg = ($this->db->affected_rows() > 0) ? $lastId : 0; //for insert			return $msg;		}				}			/* function listing($limit,$start)	{		$this->db->select('*');		$this->db->from($this->tbl_name);		$this->db->limit($limit, $start);		$this->db->order_by('priority','asc');		$query = $this->db->get();		//echo $this->db->last_query();die;		return $query->result_array();	} */   function listing($limit,$start)	{		$query = $this->db->query("SELECT c.id as userid,c.username as uname,c.email as useremail,c.portalloginpassword as userportalloginpassword,c.firstname as userfirstname,c.lastname as userlastname,c.mobilephone as usermobilephone,c.address as useraddress,c.zone as userzone,c.lco as userlco,c.distributer as userdistributer,c.bussiness_Partner as userbussiness_Partner,c.plan_id as userplan_id,c.company as usercompany,c.leadsource as userleadsource,c.servicetype as userservicetype,c.connection_type as userconnection_type,g.*,f.* FROM userinfo c left join userbillinfo g on c.username=g.username left join tbl_network_doc f on c.username=f.username where c.is_active = '1' order by c.id ASC limit $start, $limit");		//echo $this->db->last_query();die;		return $query->result_array();	}		  function index()	{		//pr($_POST);die;		$info_btn = $this->input->post('user[info-btn]');		$userinfo_btn = $this->input->post('userinfo[userinfo-btn]');		$billing_btn = $this->input->post('billing[billing-btn]');		$payment_btn = $this->input->post('payment[payment-btn]');		$network_btn = $this->input->post('network[network-btn]');		$docoment_btn = $this->input->post('docoment[docoment-btn]');			if($info_btn == 'Next'){        $username = $this->input->post('user[username]');		$data = array(			    'username' => $this->input->post('user[username]'),				//'portalloginpassword' => $this->input->post('user[portalloginpassword]'),				'zone' => $this->input->post('user[zone]'),				'plan_id' => $this->input->post('planname'),				'lco' => $this->input->post('user[lco]'),				'distributer' => $this->input->post('user[distributer]'),				'bussiness_Partner' => $this->input->post('user[bussiness_Partner]'),				'leadsource' => $this->input->post('user[leadsource]'),				'connection_type' => $this->input->post('user[connection_type]'),				'servicetype' => $this->input->post('user[servicetype]'),		);		//echo'<pre>';print_r($data);echo'</pre>';die;		    $msg = 0;			$this->db->where('username', $username);			$this->db->update('userinfo', $data);			//echo $this->db->last_query();die;			$msg = ($this->db->affected_rows() > 0) ? 1 : 0; //for insert			return $msg;		}					 if($userinfo_btn == 'Next'){			$priority = $this->get_length('userinfo');			$username = $this->input->post('user[username]');			$data = array(				'firstname' => $this->input->post('userinfo[firstname]'),				'lastname' => $this->input->post('userinfo[lastname]'),				'email' => $this->input->post('userinfo[email]'),				'company' => $this->input->post('userinfo[company]'),				'mobilephone' => $this->input->post('userinfo[mobilephone]'),				'address' => $this->input->post('userinfo[address]'),				'city' => $this->input->post('city'),			    'state' => $this->input->post('state'),			    'country' => $this->input->post('country'),				//'usertype' => $this->input->post('userinfo[usertype]'),				//'authtype' => $this->input->post('userinfo[authtype]'),			);			//echo'<pre>';print_r($data);echo'</pre>';die;			$msg = 0;			$this->db->where('username', $username);			$this->db->update('userinfo', $data);			//echo $this->db->last_query();die;			$msg = ($this->db->affected_rows() > 0) ? 1 : 0; //for insert			return $msg;		}								if($billing_btn == 'Next'){			    $username = $this->input->post('billing[username]');				$data = array(				'username' => $this->input->post('billing[username]'),				'plan_id' => $this->input->post('planname'),				//'hotspot_id' => $this->input->post('billing[hotspot_id]'),				//'hotspotlocation' => $this->input->post('billing[hotspotlocation]'),				'contactperson' => $this->input->post('billing[contactperson]'),				'company' => $this->input->post('billing[company]'),				'email' => $this->input->post('billing[email]'),				'phone' => $this->input->post('billing[phone]'),				'address' => $this->input->post('billing[address]'),				'phone' => $this->input->post('billing[phone]'),				'city' => $this->input->post('city'),			    'state' => $this->input->post('state'),			    'country' => $this->input->post('country'),				'zip' => $this->input->post('billing[zip]'),				'lastbill' => $this->input->post('billing[lastbill]'),				'nextbill' => $this->input->post('billing[nextbill]'),				'nextinvoicedue' => $this->input->post('billing[nextinvoicedue]'),				'billdue' => $this->input->post('billing[billdue]'),				'postalinvoice' => $this->input->post('billing[postalinvoice]'),				'emailinvoice' => $this->input->post('billing[emailinvoice]'),				//'batch_id' => $this->input->post('billing[batch_id]'),					);			//echo'<pre>';print_r($data);echo'</pre>';die;			$msg = 0;			$query = $this->db->query("select * from userbillinfo where username='".$username."'");			//echo $this->db->last_query();die;		    $count = $query->num_rows();			if ($count > 0){				$this->db->where('username', $username);			    $this->db->update('userbillinfo', $data);					$msg = ($this->db->affected_rows() > 0) ? 2 : 3;//for update : for nothing happened			}			else{				$this->db->insert('userbillinfo', $data);				//echo $this->db->last_query();die;				$msg = ($this->db->affected_rows() > 0) ? 1 : 0; //for insert			}			return $msg;		}								if($payment_btn == 'Next'){			    $username = $this->input->post('billing[username]');				$data = array(				'creditcardtype' => $this->input->post('payment[creditcardtype]'),				'cash' => $this->input->post('payment[cash]'),				'creditcardname' => $this->input->post('payment[creditcardname]'),				'creditcardnumber' => $this->input->post('payment[creditcardnumber]'),				'creditcardverification' => $this->input->post('payment[creditcardverification]'),				'changeuserbillinfo' => $this->input->post('payment[changeuserbillinfo]'),				'installtion_amount' => $this->input->post('payment[installtion_amount]'),				'setup_charges' => $this->input->post('payment[setup_charges]'),				'lead' => $this->input->post('payment[lead]'),				'coupon' => $this->input->post('payment[coupon]'),				'ordertaker' => $this->input->post('payment[ordertaker]'),				'billstatus' => $this->input->post('payment[billstatus]'),			);			//echo'<pre>';print_r($data);echo'</pre>';die;			$msg = 0;			$this->db->where('username', $username);			$this->db->update('userbillinfo', $data);				//echo $this->db->last_query();die;			$msg = ($this->db->affected_rows() > 0) ? 1 : 0; //for insert			return $msg;		}			if($network_btn == 'Next'){		        $username = $this->input->post('network[username]');				$data = array(				'username' => $this->input->post('network[username]'),				'static_ip' => $this->input->post('network[static_ip]'),				'mac_bind' => $this->input->post('network[mac_bind]'),				'option82' => $this->input->post('network[option82]'),				'pool_name' => $this->input->post('network[pool_name]'),				'nasport_bind' => $this->input->post('network[nasport_bind]'),				'option82_bind' => $this->input->post('network[option82_bind]'),				'mac' => $this->input->post('network[mac]'),				'nasport_id' => $this->input->post('network[nasport_id]'),				'option82_string' => $this->input->post('network[option82_string]'),			);			//echo'<pre>';print_r($data);echo'</pre>';die;			$msg = 0;			$query = $this->db->query("select * from tbl_network_doc where username='".$username."'");			//echo $this->db->last_query();die;		    $count = $query->num_rows();			if ($count > 0){				$this->db->where('username', $username);			    $this->db->update('tbl_network_doc', $data);				$msg = ($this->db->affected_rows() > 0) ? 2 : 3;//for update : for nothing happened			}			else{				$this->db->insert('tbl_network_doc', $data);				//echo $this->db->last_query();die;				$msg = ($this->db->affected_rows() > 0) ? 1 : 0; //for insert			}			return $msg;		}										if($docoment_btn == 'Next'){			    $username = $this->input->post('network[username]');			    $data2 = array();				$data3 = array();				$data4 = array();				$data5 = array();				$data6 = array();		        $banner_image_1 = $this->uploadImageObject($_FILES['profilepic1']);				$banner_image_2 = $this->uploadImageObject($_FILES['profilepic2']);				$banner_image_3 = $this->uploadImageObject($_FILES['profilepic3']);				$banner_image_4 = $this->uploadImageObject($_FILES['profilepic4']);				$banner_image_5 = $this->uploadImageObject($_FILES['profilepic5']);			    $data2 = array('image_upload_1' => $banner_image_1);				$data3 = array('image_upload_2' => $banner_image_2);				$data4 = array('image_upload_3' => $banner_image_3);				$data5 = array('image_upload_4' => $banner_image_4);				$data6 = array('image_upload_5' => $banner_image_5);				$data1 = array(				'id_proof' => $this->input->post('docoment[id_proof]'),				'id_proof_type' => $this->input->post('docoment[id_proof_type]'),				'address_proof_type' => $this->input->post('docoment[address_proof_type]'),				'upload_customer_acquisition' => $this->input->post('docoment[upload_customer_acquisition]'),				'upload_installation_report' => $this->input->post('docoment[upload_installation_report]'),				'installation_time' => $this->input->post('docoment[installation_time]'),			);			//echo'<pre>';print_r($data);echo'</pre>';die;			$data = array_merge($data1,$data2 ,$data3 ,$data4 ,$data5,$data6);		    //echo'<pre>';print_r($data);echo'</pre>';die;			$msg = 0;			$this->db->where('username', $username);			$this->db->update('tbl_network_doc', $data);			//echo $this->db->last_query();die;			$msg = ($this->db->affected_rows() > 0) ? 1 : 0; //for insert			return $msg;		} 		}			function checkSlugExists($slug, $tbl_name){		$serviceslug = '';		$query = $this->db->query("select * from ".$tbl_name." where slug='".$slug."'");		$count = $query->num_rows();		// if slug pre exists		if ($count > 0) {			$id=rand(10000,99999);  			$shorturl=base_convert($id,20,36);			$serviceslug = $slug.$shorturl;			return $serviceslug;		}else		return $slug;	}		function delete($pageid){		$this->db->delete($this->tbl_name, array('id' => $pageid));		return ($this->db->affected_rows() != 1) ? false : true;  	}					function status($id,$status){		$this->db->where('id',$id );        $this->db->set("is_active", $status);        $this->db->update($this->tbl_name);		//$this->output->enable_profiler(TRUE);		return ($this->db->affected_rows() > 0) ? 2 : 0;//for insert // for update  	}			//function count_all($startdate,$enddate,$specificOption,$specificValue){  	/* function count_all(){		$this->db->select('*');		$query = $this->db->get($this->tbl_name);		return ($query->num_rows());	} */		function count_all(){		$query = $this->db->query("SELECT * FROM userinfo c left join userbillinfo g on c.username=g.username left join tbl_network_doc f on c.username=f.username where c.is_active = '1' order by c.id ASC");		//echo $this->db->last_query();die;		return ($query->num_rows());	}		function page_info($id=0){		$query = $this->db->query("SELECT c.id as userid,c.username as uname,c.email as useremail,c.portalloginpassword as userportalloginpassword,c.firstname as userfirstname,c.lastname as userlastname,c.mobilephone as usermobilephone,c.address as useraddress,c.zone as userzone,c.lco as userlco,c.distributer as userdistributer,c.bussiness_Partner as userbussiness_Partner,c.plan_id as userplan_id,c.company as usercompany,c.leadsource as userleadsource,c.servicetype as userservicetype,c.connection_type as userconnection_type,g.*,f.* FROM userinfo c left join userbillinfo g on c.username=g.username left join tbl_network_doc f on c.username=f.username where c.is_active = '1' and c.id='$id' order by c.id ASC");		//echo $this->db->last_query();die;		return $query->result_array();	}				function billing_info($id=0){		$username = getFieldFromUserId($id, 'username', 'userinfo');		$this->db->select('*');		$this->db->from('userbillinfo');		//pr($username);die;		if(!empty($username)){			$this->db->where('username',$username);		}		$query = $this->db->get();		//echo $this->db->last_query();die;		return $query->result_array();	}				function payment_info($id=0){		$username = getFieldFromUserId($id, 'username', 'userinfo');		$this->db->select('*');		$this->db->from('userbillinfo');		//pr($username);die;		if(!empty($username)){			$this->db->where('username',$username);		}		$query = $this->db->get();		//echo $this->db->last_query();die;		return $query->result_array();	}	 	 	 	 function network_info($id=0){		$username = getFieldFromUserId($id, 'username', 'userinfo');		$this->db->select('*');		$this->db->from('tbl_network_doc');		//pr($username);die;		if(!empty($username)){			$this->db->where('username',$username);		}		$query = $this->db->get();		//echo $this->db->last_query();die;		return $query->result_array();	}				function docoment_info($id=0){		$username = getFieldFromUserId($id, 'username', 'userinfo');		$this->db->select('*');		$this->db->from('tbl_network_doc');		//pr($username);die;		if(!empty($username)){			$this->db->where('username',$username);		}		$query = $this->db->get();		//echo $this->db->last_query();die;		return $query->result_array();	}				function Updatepriority($id,$priority)	{		$this->db->where('id',$id );        $this->db->set("priority", $priority);        $this->db->update($this->tbl_name);		//$this->output->enable_profiler(TRUE);		//return ($this->db->affected_rows() > 0) ? 2 : 0;//for insert // for update	}			function get_length($tbl_name){		$this->db->select('*');		$this->db->from($tbl_name);		$query = $this->db->get();		return count($query->result_array())+1;	}				function Getplan(){		$query = $this->db->get('billing_plans');		$role[''] = "Select Plan*";		foreach($query->result() as $row){			$role[$row->id] =  ucfirst($row->planName);		}		return $role;	}		public function uploadImageObject($objfile)	{		//echo '<pre>';print_r($objfile);die;		$time = time();		$url = 'assets/docoment_proof/'.$time."_".$objfile['name'];	 	//extensive suitability check before doing anything with the file...	    if (($objfile == "none") || (empty($objfile['name'])) )	    {	       $message = "No file uploaded.";	       $url  = '';	    }	    else if ($objfile["size"] == 0)	    {	       $message = "The file is of zero length.";$url  = '';	    }	    else if (!is_uploaded_file($objfile["tmp_name"]))	    {	       $message = "You may be attempting to hack our server. We're on to you; expect a knock on the door sometime soon.";	       $url  = '';	    }	    else {	      $message = "";	      $move = @ move_uploaded_file($objfile['tmp_name'], $url);	      if(!$move)	      {	         $message = "Error moving uploaded file. Check the script is granted Read/Write/Modify permissions.";	         $url  = '';	      }	    }	    return $url;	}}?>